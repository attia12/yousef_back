pipeline {
    agent any

    stages {

        stage('Récupération du code de la branche') {
            steps {
                git branch: 'master', url: 'https://github.com/attia12/yousef_back.git'
            }
        }

        stage("MAVEN BUILD") {
            steps {
                sh 'mvn clean install -Dmaven.test.skip=true'
            }
        }
         stage("MOCKITO") {
                      steps {

                        sh "mvn test -Dtest=com.example.Task_Management.ProjectServiceTest"
                      }
                    }
         stage('SonarQube') {
                     steps {

                         // Provide SonarQube authentication using the provided token
                         withCredentials([string(credentialsId: 'scanner', variable: 'SONAR_TOKEN')]) {
                             sh "mvn sonar:sonar -Dsonar.login=$SONAR_TOKEN"

                          }
                     }
                 }
             stage('Publish Artifacts to Nexus') {
                           steps {

                                script {
                                                   nexusArtifactUploader artifacts: [[
                                                       artifactId: 'Task_Management',
                                                       classifier: '',
                                                       file: 'target/Task_Management-0.0.1.jar',
                                                       type: 'jar']],
                                                       credentialsId: 'nexuss',
                                                       groupId: 'com.example',
                                                       nexusUrl: '192.168.1.17:8081',
                                                       nexusVersion: 'nexus3',
                                                       protocol: 'http',
                                                       repository: 'spring/',
                                                       version: '1.0'
                                               }

                           }
               }


    }

}
